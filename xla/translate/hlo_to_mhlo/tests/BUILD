load("Windows_tests.bzl", "create_windows_tests")
load("linux_tests.bzl", "create_linux_tests")
load("@llvm-project//llvm:lit_test.bzl", "lit_test", "package_path")
load("@bazel_skylib//rules:expand_template.bzl", "expand_template")
load("//xla/tsl:tsl.bzl", "if_windows", "if_not_windows")


package(
    # copybara:uncomment default_applicable_licenses = ["//tensorflow:license"],
    licenses = ["notice"],
)

# Use select to determine which tests to run based on the platform
if_windows([create_windows_tests()])
#if_not_windows([create_linux_tests()])

# Expand the template
expand_template(
    name = "lit_site_cfg_py",
    testonly = True,
    out = "lit.site.cfg.py",
    substitutions = {
        "@LIT_SITE_CFG_IN_HEADER@": "# Autogenerated, do not edit.",
        "@LLVM_TOOLS_DIR@": package_path("@llvm-project//llvm:BUILD"),
        "@SHLIBEXT@": ".so",
        "@ENABLE_SHARED@": "1",
        "@ENABLE_ASSERTIONS@": "1",
        # Separate '@' (reference to main repo) to avoid confusing copybara.
        "@xla_Translate_TOOLS_DIR@": package_path("@" + "//xla/translate:BUILD"),
        "@xla_Translate_Source_DIR@": package_path("@" + "//xla/translate/hlo_to_mhlo:BUILD"),
    },
    template = "lit.site.cfg.py.in",
    visibility = ["//visibility:private"],
)
