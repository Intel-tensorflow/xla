load("windows_tests.bzl", "windows_tests")
load("linux_tests.bzl", "linux_tests")
load("@bazel_skylib//rules:build_test.bzl", "build_test")
load("@bazel_skylib//rules:expand_template.bzl", "expand_template")
load("@llvm-project//llvm:lit_test.bzl", "lit_test", "package_path")
load("//xla/tsl:tsl.bzl", "if_windows", "if_not_windows", "if_linux_x86_64")

package(
    # copybara:uncomment default_applicable_licenses = ["//tensorflow:license"],
    licenses = ["notice"],
)

# Use select to determine which tests to run based on the platform
test_win=if_windows([1])
windows_tests(test_win)
linux_tests(test_win)

expand_template(
    name = "lit_site_cfg_py",
    testonly = True,
    out = "lit.site.cfg.py",
    substitutions = {
        "@LIT_SITE_CFG_IN_HEADER@": "# Autogenerated, do not edit.",
        "@LLVM_TOOLS_DIR@": package_path("@llvm-project//llvm:BUILD"),
        "@SHLIBEXT@": ".so",
        "@ENABLE_SHARED@": "1",
        "@ENABLE_ASSERTIONS@": "1",
        # Separate '@' (reference to main repo) to avoid confusing copybara.
        "@XLA_TRANSLATE_TOOLS_DIR@": package_path("@" + "//xla/translate:BUILD"),
        "@XLA_TRANSLATE_SOURCE_DIR@": package_path("@" + "//xla/translate/mhlo_to_hlo:BUILD"),
    },
    template = "lit.site.cfg.py.in",
    visibility = ["//visibility:private"],
)



